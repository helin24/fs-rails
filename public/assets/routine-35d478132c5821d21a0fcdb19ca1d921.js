$(function(){$(".group-item").on("click",function(){o(this)});var t=function(){var t="Level",e=1;n(t,e)},e=function(){$(".active-group").removeClass("active-group"),$(".active-element").removeClass("active-element")},n=function(t,n){e(),$(".group-item#"+t+"-"+n).addClass("active-group"),$(".element-item."+t+"."+n).addClass("active-element"),$("#custom-element").addClass("active-element")},o=function(t){var e=t.id.split("-");activeGroup=e[0],activeId=e[1],n(activeGroup,activeId)},s=function(){var t=new Routine,e=$("#routine-box").find("li");for(i=0;i<e.length;i++){var n=$(e[i]),o=new Element(n);t.elements.push(o)}return t};t();s();$(".element-item").draggable({scroll:!1,appendTo:".routine",helper:"clone"}),$(".routine-item").draggable({scroll:!1,containment:"parent"}),$("#routine-box").droppable({activeClass:"dragged",drop:function(t,e){e.draggable.hasClass("element-item")?($item=e.draggable.clone(),a($item)):$item=e.draggable,$(this).append($item),r($item,$(this),e)}}),$("#routine-box").on("click",".delete-element",function(){$(this).parent().addClass("deleted"),$(this).parent().css({display:"none"})});var a=function(t){t.removeClass("element-item"),t.addClass("routine-item"),t.draggable({scroll:!1,containment:"parent"})},r=function(t,e,n){var i=n.offset,o=e.offset(),s=i.top-o.top,a=i.left-o.left,r=e.height(),l=e.width();s=Math.max(0,s),s=Math.min(s,r),a=Math.max(0,a),a=Math.min(a,l),t.css({position:"absolute",top:s,left:a}),t[0].setAttribute("top",s),t[0].setAttribute("left",a)};$(".new_routine").on("submit",function(){event.preventDefault();var t=$(this).serialize();t=t+"&routine_elements="+JSON.stringify(s());var e=$(this).find("input[type='submit']").first();$.ajax({url:this.action,type:"post",data:t,success:function(t){replaceForm(t),l(t),e=$("input[type='submit']").first(),m(e)}})}),$("#routine-info").on("click",".edit_routine input[value=Save]",function(){event.preventDefault(),form=this.parentElement;var t=$(form).find("input[type='submit']").first(),e=$(form).serialize();e=e+"&routine_elements="+JSON.stringify(s()),$.ajax({url:form.action,type:"put",data:e,success:function(e){l($(e)),m(t)}})}),$("#routine-box").on("click","#custom-element",function(){$(this).find("#custom-text").css({display:"none"}),$(this).find(".custom-input").css({display:"inline"})}),$("#routine-box").on("focusout","#custom-element",function(){u($(this)),c($(this))}),replaceForm=function(t){$("#routine-info").html(t)};var l=function(t){$response=$(t);var e=$response.children("#routine_name").attr("value"),n=$response.children("#routine_id").attr("value"),i="routines/"+n+"/edit",o="<a href='"+i+"'>"+e+"</a>";$("#nav-bar .selected").html(o)},u=function(t){$input=t.find(".custom-input"),$input.attr("value",$input.val()),$input.css({display:"none"})},c=function(t){var e=t.find(".custom-input").val(),n=t.find("#custom-text");n.text(e),n.css({display:"inline"})},m=function(t){var e=t.css("color"),n=t.css("background-color"),i=t.css("border-color");t.css({color:"#000"}),t.css({"background-color":"#08A20C"}),t.css({"border-color":"#045106"}),t.attr("value","Saved!"),setTimeout(function(){t.css("color",e),t.css("background-color",n),t.css("border-color",i),t.attr("value","Save")},1200)}});var Routine=function(){this.elements=[]},Element=function(t){this.id=t.attr("element-id"),this.top=t.attr("top"),this.left=t.attr("left"),this.elementable_type=t.attr("type"),this.elementable_id=t.attr("type-id"),"custom-element"===t.attr("id")&&(this.custom_name=t.find(".custom-input").attr("value")),t.hasClass("deleted")&&(this.deleted=!0)};